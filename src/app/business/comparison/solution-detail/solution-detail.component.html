<button id='create-btn' routerLink='../create' mat-fab color="primary">
    <mat-icon>add</mat-icon>
</button>

<ng-template #loadingTemp>
    <div ogms-loading>
        <mat-spinner></mat-spinner>
    </div>
</ng-template>

<ogms-detail-layout *ngIf='solution else loadingTemp'>
    <div class='header-title' [class.read]='titleMode === "READ"'>
        <ng-container *ngIf='titleMode === "WRITE" else readTemp'>
            <span class='topic-name'>
                <mat-form-field>
                    <input matInput placeholder='Topic Name' [(ngModel)]='solution.meta.name' required minlength="5">
                    <mat-error *ngIf='"required"'>必填</mat-error>
                    <mat-error *ngIf='"minlength"'>长度不够</mat-error>
                </mat-form-field>
            </span>
            <div class='title-btn-group'>
                <button mat-button color='primary' (click)='onTitleEditSave()'>Save</button>
                <button mat-button color='primary' (click)='onTitleEditCancel()'>Cancel</button>
            </div>
        </ng-container>
        <ng-template #readTemp>
            <h2>{{solution.meta.name}}</h2>
            <div class='title-btn-group'>
                <button mat-button color='primary' *ngIf='couldEdit' (click)='onTitleEditClick()'>Edit</button>
                <!-- <button mat-flat-button color='primary' *ngIf='couldEdit' [routerLink]='["../create"]'>New Topic</button> -->
            </div>
        </ng-template>
    </div>

    <div class='header-meta'>
        <p>{{solution.meta.desc}}</p>
        <a class='author' routerLink='/user'>{{solution.auth.userName}}</a> created this solution at
        {{solution.meta.time | date: 'yyyy.MM.dd'}}
    </div>

    <div class='article'>
        <mat-tab-group>
            <mat-tab label='Wiki'>
                <div class='wiki-tab' *ngIf='descMode === "WRITE"'>
                    <simplemde [(ngModel)]='solution.meta.wikiMD' [options]='mdeOption'></simplemde>
                    <div class='desc-btn-group'>
                        <button mat-button color='primary' (click)='onDescEditCancel()'>Cancel</button>
                        <button mat-button color='primary' (click)='onDescEditSave()'>Save</button>
                    </div>
                </div>
                <div class='wiki-tab' *ngIf='descMode === "READ"'>
                    <div [innerHTML]='solution.meta.wikiHTML'></div>
                    <div class='desc-btn-group'>
                        <button mat-button color='primary' *ngIf='couldEdit' (click)='onDescEditClick()'>Edit</button>
                    </div>
                </div>
            </mat-tab>

            <mat-tab label='Configuration'>
                <ogms-cmp-sln-outline [solution]='solution'></ogms-cmp-sln-outline>
            </mat-tab>

            <mat-tab label='Conversation'>
                <ogms-conversation [ngModel]='conversation'></ogms-conversation>
            </mat-tab>
        </mat-tab-group>
    </div>

    <div class='aside'>
        <div>
            <ogms-sidebar-section>
                <div class='title'>
                    Topic
                    <mat-icon inline>settings</mat-icon>
                </div>
                <div class='body'>

                </div>
            </ogms-sidebar-section>
        </div>

        <div>
            <ogms-sidebar-section>
                <div class='title'>
                    Tasks
                    <mat-icon inline>settings</mat-icon>
                </div>
                <div class='body'>

                </div>
            </ogms-sidebar-section>
        </div>

        <div>
            <ogms-sidebar-section>
                <div class='title'>
                    Models
                    <mat-icon inline>settings</mat-icon>
                </div>
                <div class='body'>

                </div>
            </ogms-sidebar-section>
        </div>

        <div>
            <ogms-sidebar-section>
                <div class='title'>
                    {{users.length}} Participants
                </div>
                <div class='body participants'>
                    <ng-container *ngFor='let user of users'>
                        <img [attr.src]='"data:image/png;base64," + user.avator'>
                    </ng-container>
                </div>
            </ogms-sidebar-section>
        </div>

        <div class='notification'>
            <ogms-sidebar-section>
                <div class='title'>
                    Notifications
                </div>
                <div class='body'>
                    <a mat-stroked-button (click)='onSubscribeToggle()'>
                        <ng-container *ngIf='includeUser else noticeTemp'>
                            <mat-icon inline>notifications_off</mat-icon>Unsubscribe
                        </ng-container>
                        <ng-template #noticeTemp>
                            <mat-icon inline>notifications</mat-icon>Subscribe
                        </ng-template>
                    </a>
                </div>
            </ogms-sidebar-section>
        </div>
    </div>
</ogms-detail-layout>
