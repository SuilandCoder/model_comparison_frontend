<div class="container flex-box-col-nowrap max-height">
    <h4>Comparison Object List:</h4>
    <div>
        <button nz-button [nzType]='"primary"' (click)='addCmpObj()'>
                <i class="anticon anticon-plus"></i>
                <span>Add</span>
            </button>
        <div class="flex-item-1-1-auto"></div>
    </div>

    <div style='margin: 10px 0;'>
        <nz-collapseset [nzBordered]="false" [nzAccordion]='true'>
            <nz-collapse *ngFor="let cmpObj of cmpObjs" [nzTitle]="cmpObj.meta.name? cmpObj.meta.name: 'New Comparison Object'" [nzActive]="cmpObj.attached.active">
                <!-- <form nz-form [nzType]="'horizontal'"> -->
                <h5 style='margin: 10px 0;'>Meta Information:</h5>
                <div nz-row [nzGutter]='"20"'>
                    <div nz-col [nzSpan]="10" nz-form-item nz-row>
                        <div nz-form-label nz-col [nzSpan]="5">
                            <label>Name</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="12">
                            <nz-input [(ngModel)]='cmpObj.meta.name' (ngModelChange)='checkAccordionValid(cmpObj)' name='cmpObj-name'></nz-input>
                        </div>
                    </div>
                    <div nz-col [nzSpan]="10" nz-form-item nz-row>
                        <div nz-form-label nz-col [nzSpan]="5">
                            <label>Description</label>
                        </div>
                        <div nz-form-control nz-col [nzSpan]="12">
                            <nz-input [(ngModel)]='cmpObj.meta.desc' (ngModelChange)='checkAccordionValid(cmpObj)' name='cmpObj-desc'></nz-input>
                        </div>
                    </div>
                </div>

                <h5 style='margin: 10px 0;'>Data Reference:</h5>
                <nz-table #nzTable [nzDataSource]='cmpObj.dataRefers' [nzIsPagination]="false" [nzSize]='"small"'>
                    <thead nz-thead>
                        <tr>
                            <th nz-th>
                                <span>Model</span>
                            </th>
                            <th nz-th>
                                <span>Data</span>
                            </th>
                            <th nz-th>
                                <span>Field</span>
                            </th>
                            <th nz-th>
                                <span>Schema</span>
                            </th>
                            <th nz-th>
                                <span>Edit</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody nz-tbody>
                        <tr nz-tbody-tr *ngFor='let refer of nzTable.data'>
                            <td nz-td>{{refer.msName | string:'undefined'}}</td>
                            <td nz-td>{{refer.eventName | string:'undefined'}}</td>
                            <td nz-td>{{refer.data.field | string:'undefined'}}</td>
                            <td nz-td *ngIf='refer.schema$ else nullSchema'>
                                <span [class.warning-td]='cmpObj.schemaTypes.length > 1' [class.success-td]='cmpObj.schemaTypes.length <= 1'>
                                    {{refer.schema$.type | string:'undefined'}}
                                </span>
                            </td>
                            <ng-template #nullSchema>
                                <td nz-td>-</td>
                            </ng-template>
                            <td nz-td>
                                <a (click)='showModal(cmpObj, refer.msId)'>edit</a>
                            </td>
                        </tr>
                    </tbody>
                </nz-table>

                <h5 style='margin: 10px 0;'>Comparison Schema</h5>
                <div>
                    <ng-container *ngIf='cmpObj.schemaTypes.length === 0 else tagsTemplate'>
                        <nz-tag [nzColor]='"red"'>undefined</nz-tag>
                    </ng-container>
                    <ng-template #tagsTemplate>
                        <nz-tag *ngFor='let schemaType of cmpObj.schemaTypes' [nzColor]='(cmpObj.schemaTypes.length > 1) ? "red" : "green"'>
                            {{schemaType}}
                        </nz-tag>
                    </ng-template>
                </div>


                <h5 style='margin: 10px 0;'>Comparison Method</h5>
                <div>
                    <nz-checkbox-group [(ngModel)]="cmpObj.methods" (ngModelChange)='checkAccordionValid(cmpObj)'></nz-checkbox-group>
                </div>
                <!-- </form> -->
            </nz-collapse>
        </nz-collapseset>
    </div>

    <ogms-form-cmp-objs-modal [ms]='selectedMS' [showModal]='isModalVisible' (onCancel)='modalCancel()' (onSubmit)='modalSubmit($event)'></ogms-form-cmp-objs-modal>
</div>